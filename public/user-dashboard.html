<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: linear-gradient(135deg, #1c92d2 0%, #f2fcfe 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* মোবাইল ভিউতে প্যাডিং সরিয়ে দেওয়া হয়েছে */
        }

        /* ড্যাশবোর্ডের মূল বডি */
        .dashboard-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 80vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: popIn 0.5s ease;
        }

        /* --- মোবাইল রেসপন্সিভ ফিক্স (এই অংশ নতুন) --- */
        @media (max-width: 768px) {
            body {
                align-items: flex-start; /* উপরে নিয়ে যাবে */
                background: #fff; /* মোবাইলে সাদা ব্যাকগ্রাউন্ড */
            }
            .dashboard-container {
                height: 100vh; /* পুরো স্ক্রিন */
                max-width: 100%;
                border-radius: 0; /* কোণা গোল হবে না */
                border: none;
                box-shadow: none;
            }
        }

        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* হেডার */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .header h2 { color: #333; font-weight: 600; font-size: 20px; }

        /* প্রোফাইল আইকন */
        .profile-icon {
            width: 40px;
            height: 40px;
            background: #1c92d2;
            color: #fff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s;
        }

        /* নোটিশ বোর্ড */
        .notice-board {
            margin: 20px;
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            color: #856404;
            font-size: 14px;
        }
        .notice-title { font-weight: bold; display: block; margin-bottom: 5px; }

        /* ওয়েলকাম মেসেজ */
        .content-area {
            flex: 1;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #444;
        }
        .content-area h1 { margin-bottom: 10px; color: #1c92d2; }

        /* প্রোফাইল মডাল (Popup) */
        .profile-modal {
            position: absolute;
            top: 70px;
            right: 15px;
            width: 300px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            padding: 20px;
            display: none; 
            z-index: 100;
            border: 1px solid #f0f0f0;
        }
        .profile-modal.active { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; top: 60px; } to { opacity: 1; top: 70px; } }

        .profile-info h3 { font-size: 18px; margin-bottom: 2px; color: #333; }
        .profile-info p { font-size: 13px; color: #666; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }

        /* ইনপুট এবং বাটন */
        .update-form input {
            width: 100%; padding: 10px; margin-bottom: 10px;
            border: 1px solid #ddd; border-radius: 5px; font-size: 13px; outline: none;
        }
        .update-form input:focus { border-color: #1c92d2; }

        .btn {
            width: 100%; padding: 10px; border: none; border-radius: 5px;
            cursor: pointer; font-weight: 600; font-size: 14px; margin-top: 5px;
        }
        .btn-update { background: #28a745; color: #fff; margin-bottom: 10px; }
        .btn-logout { background: #dc3545; color: #fff; }

        /* টোস্ট নোটিফিকেশন */
        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 5px; padding: 16px; position: fixed;
            z-index: 200; top: 30px; left: 50%; transform: translateX(-50%);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
    </style>
</head>
<body>

    <div id="toast">Notification</div>

    <div class="dashboard-container">
        <div class="header">
            <h2>My Dashboard</h2>
            <div class="profile-icon" onclick="toggleProfile()">
                <i class="fas fa-user"></i>
            </div>
        </div>

        <div class="notice-board" id="notice-section">
            <span class="notice-title"><i class="fas fa-bullhorn"></i> Notice:</span>
            <span id="admin-notice-text">Loading updates...</span>
        </div>

        <div class="content-area">
            <h1 id="welcome-msg">Welcome!</h1>
            <p>আপনার প্রোফাইল লোড হচ্ছে...</p>
        </div>

        <div class="profile-modal" id="profile-modal">
            <div class="profile-info">
                <h3 id="p-name">Loading Name...</h3>
                <p id="p-details">Loading Info...</p>
            </div>
            
            <div class="update-form">
                <label style="font-size:12px; font-weight:bold; color:#555; display:block; margin-bottom:5px;">Change Password</label>
                <input type="password" id="old-pass" placeholder="Current Password">
                <input type="password" id="new-pass" placeholder="New Password">
                <button class="btn btn-update" onclick="updatePassword()">Update</button>
            </div>

            <button class="btn btn-logout" onclick="logout()">Logout</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCHArkRwUM24OTgFZ55C26Iqf2djHvqlwI",
            authDomain: "my-test-ee4e9.firebaseapp.com",
            projectId: "my-test-ee4e9",
            storageBucket: "my-test-ee4e9.firebasestorage.app",
            messagingSenderId: "182385677359",
            appId: "1:182385677359:web:3c9705740c7575bd19a2da",
            measurementId: "G-09PLD4F6Q9"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged((user) => {
            if (user) {
                loadUserData(user.uid);
                loadNotice();
            } else {
                window.location.href = "index.html";
            }
        });

        function loadUserData(uid) {
            console.log("Checking database for User ID:", uid);
            
            db.collection('users').doc(uid).get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    console.log("Data found:", data); // কনসোলে ডাটা চেক করার জন্য

                    // ড্যাশবোর্ডে নাম বসানো
                    document.getElementById('welcome-msg').innerText = "Welcome, " + (data.name || "User") + "!";
                    document.querySelector('.content-area p').innerText = "আপনার ড্যাশবোর্ড রেডি।";
                    
                    // পপ-আপে তথ্য বসানো
                    document.getElementById('p-name').innerText = data.name || "No Name";
                    document.getElementById('p-details').innerHTML = `
                        <i class="fas fa-phone"></i> ${data.phone || "No Phone"}<br>
                        <i class="fas fa-envelope"></i> ${data.email || auth.currentUser.email}
                    `;
                } else {
                    console.log("No such document!");
                    document.getElementById('welcome-msg').innerText = "Hello!";
                    document.querySelector('.content-area p').innerText = "আপনার ডাটা পাওয়া যায়নি। দয়া করে নতুন করে রেজিস্ট্রেশন করুন।";
                }
            }).catch((error) => {
                console.log("Error getting document:", error);
                showToast("ডাটা লোড হতে সমস্যা হচ্ছে: " + error.message, "error");
            });
        }

        function loadNotice() {
            db.collection('app_data').doc('settings').onSnapshot((doc) => {
                if (doc.exists && doc.data().notice) {
                    document.getElementById('admin-notice-text').innerText = doc.data().notice;
                } else {
                    document.getElementById('admin-notice-text').innerText = "কোনো নোটিশ নেই।";
                }
            });
        }

        function toggleProfile() {
            document.getElementById('profile-modal').classList.toggle('active');
        }

        function updatePassword() {
            const oldPass = document.getElementById('old-pass').value;
            const newPass = document.getElementById('new-pass').value;
            const user = auth.currentUser;

            if (!oldPass || !newPass) {
                showToast("সব ঘর পূরণ করুন", "error");
                return;
            }

            const credential = firebase.auth.EmailAuthProvider.credential(user.email, oldPass);

            user.reauthenticateWithCredential(credential).then(() => {
                user.updatePassword(newPass).then(() => {
                    showToast("পাসওয়ার্ড আপডেট হয়েছে!", "success");
                    document.getElementById('old-pass').value = "";
                    document.getElementById('new-pass').value = "";
                }).catch((error) => { showToast(error.message, "error"); });
            }).catch((error) => { showToast("বর্তমান পাসওয়ার্ড ভুল!", "error"); });
        }

        function logout() {
            auth.signOut().then(() => { window.location.href = "index.html"; });
        }

        function showToast(msg, type) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.style.backgroundColor = type === 'error' ? '#dc3545' : '#28a745';
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }
        
        window.onclick = function(event) {
            if (!event.target.matches('.profile-icon') && !event.target.matches('.profile-icon i') && !document.getElementById('profile-modal').contains(event.target)) {
                document.getElementById('profile-modal').classList.remove('active');
            }
        }
    </script>
</body>
            </html>
