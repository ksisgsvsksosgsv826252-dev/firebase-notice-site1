<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: #f4f6f9;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- লগইন সেকশন স্টাইল --- */
        .login-container {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 350px;
            text-align: center;
        }
        .login-container h2 { color: #333; margin-bottom: 20px; }
        .login-container input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 5px; outline: none;
        }
        .login-btn {
            width: 100%; padding: 12px; background: #2c3e50; color: #fff;
            border: none; border-radius: 5px; cursor: pointer; font-size: 16px;
        }

        /* --- ড্যাশবোর্ড সেকশন স্টাইল --- */
        .dashboard-wrapper {
            display: none; /* শুরুতে লুকানো */
            width: 95%; max-width: 1200px; height: 90vh;
            background: #fff; border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex; /* Flex layout */
        }
        
        /* সাইডবার */
        .sidebar {
            width: 250px; background: #2c3e50; color: #fff;
            display: flex; flex-direction: column; padding: 20px;
        }
        .sidebar h3 { text-align: center; margin-bottom: 40px; border-bottom: 1px solid #34495e; padding-bottom: 20px; }
        .menu-item {
            padding: 15px; cursor: pointer; transition: 0.3s; border-radius: 5px; margin-bottom: 5px;
        }
        .menu-item:hover, .menu-item.active { background: #34495e; }
        .menu-item i { margin-right: 10px; width: 20px; }
        .logout-btn { margin-top: auto; background: #e74c3c; text-align: center; }

        /* মেইন কন্টেন্ট */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; background: #f8f9fa; }
        .section-title { font-size: 24px; color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        
        /* সেকশন লুকানো/দেখানো */
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ফর্ম স্টাইল */
        .form-group { margin-bottom: 15px; max-width: 500px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;
        }
        .action-btn {
            padding: 10px 20px; background: #27ae60; color: white; border: none;
            border-radius: 5px; cursor: pointer;
        }

        /* ইউজার টেবিল */
        table { width: 100%; border-collapse: collapse; background: #fff; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #2c3e50; color: #fff; }
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; color: #fff; }
        .status-active { background: #27ae60; }
        .status-inactive { background: #95a5a6; }
        .status-ban { background: #c0392b; }
        .btn-edit { background: #3498db; color: #fff; padding: 5px 10px; border-radius: 3px; cursor: pointer; border: none; }

        /* মডাল (Popup) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center;
        }
        .modal-content { background: #fff; padding: 25px; border-radius: 10px; width: 400px; }
        .close-btn { float: right; cursor: pointer; font-size: 20px; }

        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 5px; padding: 16px; position: fixed;
            z-index: 200; top: 30px; right: 30px;
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
    </style>
</head>
<body>

    <div id="toast">Alert</div>

    <div class="login-container" id="login-section">
        <h2>Admin Login</h2>
        <input type="email" id="admin-email" placeholder="Admin Email">
        <input type="password" id="admin-pass" placeholder="Password">
        <button class="login-btn" onclick="adminLogin()">Login Panel</button>
    </div>

    <div class="dashboard-wrapper" id="dashboard-section" style="display: none;">
        
        <div class="sidebar">
            <h3>Admin Panel</h3>
            <div class="menu-item active" onclick="showSection('profile')"><i class="fas fa-user-shield"></i> Admin Profile</div>
            <div class="menu-item" onclick="showSection('notifications')"><i class="fas fa-bell"></i> Notifications</div>
            <div class="menu-item" onclick="showSection('users')"><i class="fas fa-users"></i> User List</div>
            <div class="menu-item logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</div>
        </div>

        <div class="main-content">
            
            <div id="section-profile" class="content-section active">
                <h2 class="section-title">My Profile</h2>
                <div class="form-group">
                    <label>Admin Name</label>
                    <input type="text" id="adm-name" value="Admin" readonly>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" id="adm-phone" value="+8801XXXXX" readonly>
                </div>
                <div class="form-group">
                    <label>Current Password (Stored)</label>
                    <input type="text" id="adm-display-pass" readonly style="background:#eee;">
                </div>
                <hr style="margin: 20px 0;">
                <h3>Change Password</h3>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="adm-new-pass" placeholder="Enter new password">
                </div>
                <button class="action-btn" onclick="updateAdminPassword()">Update & Save</button>
            </div>

            <div id="section-notifications" class="content-section">
                <h2 class="section-title">Update User Notification</h2>
                <div class="form-group">
                    <label>Notice Message</label>
                    <textarea id="notice-text" rows="5" placeholder="Write notice for users..."></textarea>
                </div>
                <button class="action-btn" onclick="updateNotice()">Publish Notice</button>
            </div>

            <div id="section-users" class="content-section">
                <h2 class="section-title">All Users <button onclick="loadUsers()" style="font-size:12px; cursor:pointer;">(Refresh)</button></h2>
                <table>
                    <thead>
                        <tr>
                            <th>Serial</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Edit User</h3>
            <input type="hidden" id="edit-uid">
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="edit-name" readonly style="background:#eee;">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="text" id="edit-phone" readonly style="background:#eee;">
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="edit-status">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Banned">Permanent Ban</option>
                    <option value="TempBan">Temporary Ban</option>
                </select>
            </div>
            <button class="action-btn" onclick="saveUserChanges()">Save Changes</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCHArkRwUM24OTgFZ55C26Iqf2djHvqlwI",
            authDomain: "my-test-ee4e9.firebaseapp.com",
            projectId: "my-test-ee4e9",
            storageBucket: "my-test-ee4e9.firebasestorage.app",
            messagingSenderId: "182385677359",
            appId: "1:182385677359:web:3c9705740c7575bd19a2da",
            measurementId: "G-09PLD4F6Q9"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ১. এডমিন লগইন লজিক
        function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const pass = document.getElementById('admin-pass').value;

            auth.signInWithEmailAndPassword(email, pass)
                .then((cred) => {
                    checkAdminRole(cred.user.uid);
                })
                .catch((err) => showToast("Login Failed: " + err.message, "error"));
        }

        // রোল চেক করা (শুধুমাত্র এডমিন ঢুকবে)
        function checkAdminRole(uid) {
            db.collection('users').doc(uid).get().then((doc) => {
                if(doc.exists && doc.data().role === 'admin') {
                    showToast("Welcome Admin!", "success");
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('dashboard-section').style.display = 'flex';
                    loadAdminData(uid);
                } else {
                    showToast("Access Denied! You are not an Admin.", "error");
                    auth.signOut();
                }
            });
        }

        // ২. এডমিন মেনু ও নেভিগেশন
        function showSection(sectionId) {
            // সব সেকশন লুকাও
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            
            // নির্দিষ্ট সেকশন দেখাও
            document.getElementById('section-' + sectionId).classList.add('active');
            
            // ইউজারে ক্লিক করলে লিস্ট লোড হবে
            if(sectionId === 'users') loadUsers();
        }

        // ৩. এডমিন ডাটা লোড ও পাসওয়ার্ড আপডেট
        function loadAdminData(uid) {
            db.collection('users').doc(uid).get().then((doc) => {
                const data = doc.data();
                document.getElementById('adm-name').value = data.name;
                document.getElementById('adm-phone').value = data.phone;
                // পাসওয়ার্ড দেখানোর জন্য আমরা 'passwordStr' নামে ফিল্ড সেভ করব (নিরাপদ নয়, কিন্তু তোমার রিকোয়েস্ট অনুযায়ী)
                document.getElementById('adm-display-pass').value = data.passwordStr || "Hidden";
            });
        }

        function updateAdminPassword() {
            const newPass = document.getElementById('adm-new-pass').value;
            const user = auth.currentUser;

            if(newPass.length < 6) {
                showToast("Password must be 6 chars!", "error");
                return;
            }

            user.updatePassword(newPass).then(() => {
                // সার্ভারেও পাসওয়ার্ড টেক্সট হিসেবে সেভ করছি যাতে তুমি দেখতে পাও
                db.collection('users').doc(user.uid).update({
                    passwordStr: newPass
                });
                document.getElementById('adm-display-pass').value = newPass;
                document.getElementById('adm-new-pass').value = "";
                showToast("Password Updated Successfully!", "success");
            }).catch((err) => {
                showToast("Error: " + err.message + " (Please Re-login)", "error");
            });
        }

        // ৪. নোটিফিকেশন আপডেট
        function updateNotice() {
            const text = document.getElementById('notice-text').value;
            db.collection('app_data').doc('settings').set({
                notice: text
            }, { merge: true }).then(() => {
                showToast("Notice Updated for all Users!", "success");
            });
        }

        // ৫. ইউজার লিস্ট লোড ও অ্যাকশন
        function loadUsers() {
            const tbody = document.getElementById('user-table-body');
            tbody.innerHTML = "Loading...";
            
            db.collection('users').get().then((querySnapshot) => {
                tbody.innerHTML = "";
                let serial = 1;
                querySnapshot.forEach((doc) => {
                    const user = doc.data();
                    // নিজেকে (এডমিন) লিস্টে না দেখানোই ভালো
                    if(user.role === 'admin') return; 

                    const row = `
                        <tr>
                            <td>${serial++}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td><span class="status-badge ${getStatusClass(user.status)}">${user.status || 'Active'}</span></td>
                            <td>
                                <button class="btn-edit" onclick="openEditModal('${doc.id}', '${user.name}', '${user.phone}', '${user.status}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            });
        }

        function getStatusClass(status) {
            if(status === 'Inactive') return 'status-inactive';
            if(status === 'Banned') return 'status-ban';
            return 'status-active';
        }

        // ৬. ইউজার এডিট মডাল কন্ট্রোল
        function openEditModal(uid, name, phone, status) {
            document.getElementById('edit-modal').style.display = 'flex';
            document.getElementById('edit-uid').value = uid;
            document.getElementById('edit-name').value = name;
            document.getElementById('edit-phone').value = phone;
            document.getElementById('edit-status').value = status || 'Active';
        }

        function closeModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function saveUserChanges() {
            const uid = document.getElementById('edit-uid').value;
            const newStatus = document.getElementById('edit-status').value;

            db.collection('users').doc(uid).update({
                status: newStatus
            }).then(() => {
                showToast("User Status Updated!", "success");
                closeModal();
                loadUsers(); // টেবিল রিফ্রেশ
            });
        }

        function logout() {
            auth.signOut().then(() => location.reload());
        }

        function showToast(msg, type) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.style.backgroundColor = type === 'error' ? '#c0392b' : '#27ae60';
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // সেশন চেক (রিফ্রেশ দিলে যেন লগইন থাকে)
        auth.onAuthStateChanged((user) => {
            if(user) checkAdminRole(user.uid);
        });

    </script>
</body>
              </html>
